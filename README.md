# Домашнее задание к занятию «Обновление приложений»-***Вуколов Евгений***
 
### Цель задания
 
Выбрать и настроить стратегию обновления приложения.
 
### Чеклист готовности к домашнему заданию
 
1. Кластер K8s.
 
### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания
 
1. [Документация Обновление развертывания](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment).
2. [Статья про стратегии обновлений](https://habr.com/ru/companies/flant/articles/471620/).
 
-----
 
### Задание 1. Выбрать стратегию обновления приложения и описать ваш выбор
 
1. Имеется приложение, состоящее из нескольких реплик, которое требуется обновить.
2. Ресурсы, выделенные для приложения, ограничены, и нет возможности их увеличить.
3. Запас по ресурсам в менее загруженный момент времени составляет 20%.
4. Обновление мажорное, новые версии приложения не умеют работать со старыми.
5. Вам нужно объяснить свой выбор стратегии обновления приложения.
 
### Задание 2. Обновить приложение
 
1. Создать deployment приложения с контейнерами nginx и multitool. Версию nginx взять 1.19. Количество реплик — 5.
2. Обновить версию nginx в приложении до версии 1.20, сократив время обновления до минимума. Приложение должно быть доступно.
3. Попытаться обновить nginx до версии 1.28, приложение должно оставаться доступным.
4. Откатиться после неудачного обновления.
 
## Дополнительные задания — со звёздочкой*
 
Задания дополнительные, необязательные к выполнению, они не повлияют на получение зачёта по домашнему заданию. **Но мы настоятельно рекомендуем вам выполнять все задания со звёздочкой.** Это поможет лучше разобраться в материале.   
 
### Задание 3*. Создать Canary deployment
 
1. Создать два deployment'а приложения nginx.
2. При помощи разных ConfigMap сделать две версии приложения — веб-страницы.
3. С помощью ingress создать канареечный деплоймент, чтобы можно было часть трафика перебросить на разные версии приложения.
 
### Правила приёма работы
 
1. Домашняя работа оформляется в своем Git-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд, а также скриншоты результатов.
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md.



# **Решение**

### **Задание 1**

-Для обновления приложения, состоящего из нескольких реплик, с ограниченными ресурсами и без возможности их увеличения, а также учитывая, 
что новые версии приложения несовместимы со старыми, я бы выбрал стратегию Rolling Update. В чём заключается этот выбор, это :

1. Минимальные простои при использовании стратегия Rolling Update. Это позволяет обновлять приложение поэтапно, без остановки всех реплик одновременно. Приложение остается доступным 
даже во время обновления.
2. Эффективное использование ресурсов, так как ресурсы ограничены и нет возможности их увеличить, Rolling Update позволяет обновлять реплики по одной, что не требует 
дополнительных ресурсов для одновременного запуска всех новых версий. Запас по ресурсам в 20% в менее загруженные моменты времени может быть достаточным для плавного обновления.
3. Хотя новые версии приложения не могут работать со старыми, Rolling Update позволяет постепенно заменять старые версии новыми, что минимизирует риск конфликтов между версиями во время обновления.
4. Если во время обновления обнаруживаются проблемы, Rolling Update позволяет постепенно откатиться к предыдущей версии, что снижает риск широкомасштабных сбоев.
5. Проблемы обнаруживаются на ранней стадии, что снижает риск развертывания.


### **Задание 2**

- Для этого задания создаю и разворачиваю deployment приложения с контейнерами nginx и multitool на VM c K8s:

- Ссылка на deployment:

[nginx-deployment.yaml](https://github.com/Evgenii-379/3.4-3.4.md-app-update/blob/main/config.yaml/nginx-deployment.yaml)

- ![scrin](https://github.com/Evgenii-379/3.4-3.4.md-app-update/blob/main/Снимок%20экрана%202025-04-11%20204825.png)

- Проверка статуса: 

- ![scrin](https://github.com/https://github.com/Evgenii-379/3.4-3.4.md-app-update/blob/main/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202025-04-12%20095212.png)

- Обновление nginx до версии 1.20 с минимальным временем простоя и проверка статуса:

- ![scrin](https://github.com/https://github.com/Evgenii-379/3.4-3.4.md-app-update/blob/main/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202025-04-12%20104450.png)

- Обновление до версии nginx:1.28 и проверка статуса: 

- ![scrin](https://github.com/https://github.com/Evgenii-379/3.4-3.4.md-app-update/blob/main/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202025-04-12%20110636.png)
Вознкла ошибка при обновлении.

- Откат до предыдущей стабильной версии и проверка отката: 

- ![scrin](https://github.com/https://github.com/Evgenii-379/3.4-3.4.md-app-update/blob/main/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202025-04-12%20110856.png)

- Просмотр текущего состояния подов:

- ![scrin](https://github.com/https://github.com/Evgenii-379/3.4-3.4.md-app-update/blob/main/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202025-04-12%20111030.png)



 























